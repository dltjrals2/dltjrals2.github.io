---
title: "[Network] 스패닝 트리 프로토콜 2, 카타르시스 스위치, VLAN 개념 정리"

categories:
  - Network
tags:
  - [Network, STP, Catalyst Switch, VLAN]

toc:  true
toc_sticky: true
show_date: true
read_time: false
use_math: false

date: 2021-10-05
last_modified_at: 2021-10-06
sitemap :
  changefreq : daily
  priority : 1.0
---

## 6. 스위치를 켜라!  

### 10. 스패닝 트리에 변화가 생기던 날  

스패닝 트리가 완성이 된 후, 루트 브리지는 2초 마다 헬로(Hello) BPDU를 Non Root Bridge로 전송하고, 이 헬로 BPDU를 받은 Non Root Bridge들은 이것을 자신의 데지그네이티드 포트를 통해 다시 전달한다.  

여기서 Non Root Bridge들은 매 2초마다 들어오는 루트 브리지의 헬로 패킷을 보면서 루트 브리지까지 가는 길이 살아있구나 라는 걸 알게 됩니다.  

이때 만약 Non Root Bridge들이 지정된 시간 동안 헬로패킷을 받지 못하면 중간 경로에 뭔가 문제가 발생했다고 생각하고, 스패닝 트리를 재편성하는 모드로 들어가게 된다.  

- Hello Time(헬로타임) : 루트 브리지가 얼마 만에 한 번씩 헬로 BPDU를 보내는지에 대한 시간이다. 즉 루트 브리지는 자신에게 연결된 브리지들에게 헬로 BPDU를 헬로타임마다 한 번식 보내게 되는데, 디폴트 헬로타임은 2초이다.  
- Max Age(맥스 에이지) : 브리지들이 루트 브리지로부터 헬로패킷을 받지 못하면 맥스 에이지 시간 동안 기다린 후 스패닝 트리 구조 변경을 시작한다. 즉 맥스 에이지란, 브리지들이 루트 브리지로부터 얼마 동안 헬로패킷을 받지 못했을 때 루트 브리지가 죽었다고 생각하고 새로운 스패닝 트리를 만들기 시작하는가에 대한 시간이다.  
- Forwarding Delay(포워딩 딜레이) : 브리지 포트가 블로킹 상태에서 포워딩 상태로 넘어갈 때까지 걸리는 시간이다. 여기서 중요한 점은 블로킹 포트에서 리스닝 상태로 넘어간 포트는 포워딩 딜레이 시간 동안 기다린 후 러닝 상태로 넘어가고, 러닝 상태에서 다시 포워딩 딜레이 시간동안 기다린 후 포워딩 상태로 넘어가기 때문에 사실 블로킹에서 포워딩으로 넘어가는 데 걸리는 시간은 포워딩 딜레이 시간의 두 배가 된다는 점이다.  

루트 브리지는 자기와 연결된 나머지 브리즈딜에게 헬로패킷을 매 2초마다 뿌리고, 이 패킷을 받은 브리지들은 자신의 데지그네이티드 포트로 다시 그 헬로패킷을 전달한다.  

만약 링크에 문제가 생기게 되면 끊어진 Non Root Bridge는 헬로 패킷을 받지 못하게 된다. 만약 맥스 에이지인 20초 동안 헬로 패킷을 받지 못하게 되면 스패닝 트리의 변경을 시작하게 된다.  

그러면 다른 스위치에서는 계속 헬로 패킷을 받고 있기 때문에 해당 헬로 패킷을 끊긴 쪽의 블로킹 포트로 전달하게 된다.  

그러면 끊긴 스위치에서는 블로킹 포트를 루트 포트로 변경하고 블로킹에서 리스닝을 거치고 포워딩 상태로 가게 된다.  

정리하자면 다음과 같다.  

- 1. 맨 처음 루트 브리지로부터 헬로패킷을 2초마다 받던 스위치 C가 갑자기 헬로패킷이 들어오지 않게 된다.  
- 2. 참을성 많은 스위치 C는 자신의 맥스 에이지 시간인 20초 동안 루트 브리지로부터의 헬로패킷을 기다려보지만, 20초가 지나도 헬로패킷은 E0 포트를 통해 들어오지 않는다.  
- 3. 이렇게 되자 스위치 C는 B에서 전달해 준 헬로패킷을 자신의 E1 포트로 받아들여 E1 포트를 루트 포트로 세팅하게 된다.  
- 4. 물론 Non Designated 포트로 블로킹 상태에 있던 스위치 C의 E1 포트를 루트 포트로 선정했다고 해서 바로 포워딩 상태로 넘어가진 않는다. 디폴트 포워딩 딜레이 시간인 15초를 먼저 리스닝 상태에서 기다리고, 다시 한 번 러닝 상태에서 15초를 추가로 기다린 후 드디어 데이터 전송이 가능한 포워딩 상태로 넘어가게 된다. 이떼 기존의 루트 포트로 포워딩 상태였던 스위치 C의 E0 포트는 블로킹이 된다.  

스패닝 프로토콜을 이용해 다른 경로를 살리는데 걸리는 시간은 대략 50초 정도 소요되는데 시간이 오래 걸려 개선할 많은 기법이 소개되고 있다.  

예를 들어, RSTP(Rapid Spanning Tree Protocol), Port Fast, Up-link Fast, Backbone Fast 등이 있다.  

### 11. 카타리스트 스위치 바라보기  

### 12. 카타르시스 스위치 구성하기




---
**🐢 현재 공부하고 있는 `후니의 쉽게 쓴 CISCO 네트워킹 - 진강훙 저자` 의 책을 학습하며 기록 및 정리를 하기위한 내용들입니다. 🐢**
{: .notice--primary}

감사합니다.😊